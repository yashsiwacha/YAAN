#!/bin/bash
# YAAN Startup Script for Linux/Mac
# Run this to start the YAAN backend server

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                           â•‘"
echo "â•‘   â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—   â•‘"
echo "â•‘   â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â•‘"
echo "â•‘    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â•‘"
echo "â•‘     â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â•‘"
echo "â•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â•‘"
echo "â•‘      â•šâ•â•   â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•   â•‘"
echo "â•‘                                           â•‘"
echo "â•‘     Your AI Assistant Network v1.0.0     â•‘"
echo "â•‘          Offline â€¢ Private â€¢ Yours       â•‘"
echo "â•‘                                           â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if Python is installed
if ! command -v python3 &> /dev/null; then
    echo -e "${RED}âŒ Python3 not found! Please install Python 3.10+${NC}"
    echo -e "${YELLOW}Install with: sudo apt install python3 python3-pip python3-venv${NC}"
    exit 1
fi

echo -e "${GREEN}âœ“ Python found: $(python3 --version)${NC}"

# Check if virtual environment exists
VENV_PATH="./backend/venv"
if [ ! -d "$VENV_PATH" ]; then
    echo -e "${YELLOW}âš™ï¸  Creating virtual environment...${NC}"
    cd backend
    python3 -m venv venv
    cd ..
    echo -e "${GREEN}âœ“ Virtual environment created${NC}"
else
    echo -e "${GREEN}âœ“ Virtual environment exists${NC}"
fi

# Activate virtual environment and install dependencies
echo -e "${YELLOW}âš™ï¸  Activating virtual environment...${NC}"
cd backend
source venv/bin/activate

# Check if dependencies are installed
if [ ! -f "venv/installed.flag" ]; then
    echo -e "${YELLOW}âš™ï¸  Installing dependencies...${NC}"
    pip install --upgrade pip
    pip install -r requirements.txt
    touch venv/installed.flag
    echo -e "${GREEN}âœ“ Dependencies installed${NC}"
else
    echo -e "${GREEN}âœ“ Dependencies already installed${NC}"
fi

# Create necessary directories
mkdir -p data logs static

echo ""
echo -e "${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${GREEN}â•‘     ğŸš€ Starting YAAN Server...          â•‘${NC}"
echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo -e "${YELLOW}ğŸ“¡ Server will be available at:${NC}"
echo -e "${GREEN}   http://localhost:8000${NC}"
echo ""
echo -e "${YELLOW}ğŸ’¡ Press Ctrl+C to stop the server${NC}"
echo ""

# Start the server
python main.py

# Deactivate on exit
deactivate
